<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
    crossorigin="anonymous">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css"  rel="stylesheet" >
  <link href="/fullcalendar/main.css" rel="stylesheet">
  <link href="/css/main.css" rel="stylesheet">
  <style>
    #user-card{
      background-color:#EDFFE1;
      color: #426900;
    }
    #userid{
      font-size:0.8em;
    }
    .sidebar{
      background-color: #EDFFE1;
    }
    
    
  </style>
  <script src="https://code.jquery.com/jquery-3.6.1.min.js"></script>
  <script src="/fullcalendar/main.js"></script>
  <script>
    let schedule = <%- JSON.stringify(schedule) %>;
    //console.log(schedule.Users.length);
    jQuery(document).ready(($)=>{
      const calendarEl1 = $('#calendar1')[0];
      const calendarEl2 = $('#calendar2')[0];
      const calendar1 = new FullCalendar.Calendar(calendarEl1, {
        initialView: 'timeGridDay',
        allDaySlot: false,
        headerToolbar : {left:'',center:'',right:'title'},
        height : 600,
        locale : 'kr',
        initialDate : schedule.sched_day,
        eventSources : [{
          url:'../getUserTime',
          extraParams:{
            uid : schedule.Users[0].uid,
            sched_id : schedule.schedule_id
          },
          failure: ()=>{console.log("Failed to fetch data")}
        }],//`../getUserTime?uid=${schedule.User.uid}&sched_id=${schedule.schedule_id}`,
        stickyFooterScrollbar:true,
      });
      const calendar2 = new FullCalendar.Calendar(calendarEl2, {
        initialView: 'timeGridDay',
        allDaySlot: false,
        headerToolbar : {left:'',center:'',right:'title'},
        height : 600,
        locale : 'kr',
        stickyFooterScrollbar:true,
      });
      calendar1.render();
      calendar2.render();
    });
  </script>
  
</head>
<body>
  <div class="d-flex flex-nowrap">
    
    <div class="d-flex flex-column flex-shrink-0 p-3 sidebar">
      
      <a href="/" class="d-flex align-items-center mb-3 mb-md-1 me-md-auto px-2 link-dark text-decoration-none">
        <i class="bi bi-bootstrap-fill me-2" style="font-size: 1.5rem;"></i> 
        <span style="font-size:1.2rem;">
          Scheduler
        </span>
      </a>
      <hr>
      <ul class="nav nav-pills flex-column mb-auto">
        <a href="#" class="nav-link link-dark">
          <i class="bi bi-usb-mini"></i>
          일정목록
        </a>
      </ul>
      <hr>
    </div>

    <div class="container-fluid">
      <div class="position-absolute top-0 end-0 mt-2 me-2">
        <div id = "user-card" class="card m-3">
          <div class="d-inline-flex align-items-center m-1 p-1">
            <i class="bi bi-person-fill mx-2"></i>
            <div class="ms-2 me-4">
              <span id="username"> <%= schedule.Users[0].name %> </span>
              <br>
              <span id="userid">userid : <%= schedule.Users[0].uid %></span>
            </div>
            <a href="/logout" class="nav-link ">로그아웃</a>
          </div>
        </div>
      </div>

      <div class="d-flex flex-column mt-5 ms-4">
        <h1> <%= schedule.name %> </h1>
        <hr class="w-25 m-0">
        <h6 class="pt-1">날짜 <%= schedule.sched_day %></h6>
      </div>
      

      <div class="d-flex m-3">
        <div>
          <div class = "d-inline-flex flex-column p-4 mt-4 me-4 rounded shadow" style="width: max-content">
            <% for(let user of schedule.Users){ %>
              <button type="button" class="btn btn-primary fw-semibold mb-3"> <%= user.name %> </button>
            <% } %>
          </div>
        </div>
        <div class="container-sm mx-4 p-3">
          <h4 class ="text-center mb-5"><%= schedule.Users[0].name %>의 시간표</h4>
          <div id ="calendar1"></div>
        </div>
        <div class="vr"></div>
        <div class="container-sm mx-4 p-3">
          <h4 class ="text-center mb-5">모두의 시간표</h4>
          <div id ="calendar2"></div>
        </div>
      </div>
      
    </div>
  </div>
  
  
</body>